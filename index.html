<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pour toi ‚ù§Ô∏è</title>
<style>
:root{--pink:#ff4d88;--red:#ff3333}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#ffe6f0,#ffb3d9);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;padding:20px}
.hidden{display:none !important}
.card{width:100%;max-width:400px;background:white;border-radius:25px;padding:25px;text-align:center;box-shadow:0 15px 35px rgba(0,0,0,0.1);position:relative}
h1{margin:0 0 20px;font-size:1.8rem;color:#ff4d88}
p{margin:15px 0;font-size:1rem;color:#666}

/* Enveloppe */
.envelope{font-size:90px;margin:30px 0;cursor:pointer;display:inline-block;transition:transform 0.3s;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.envelope:hover{animation:none;transform:scale(1.15)}

/* Boutons */
.buttons-container{display:flex;flex-direction:column;gap:15px;margin:30px 0}
.button{width:100%;padding:18px;border:none;border-radius:50px;font-size:1.3rem;font-weight:bold;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:10px}
.button:active{transform:scale(0.95)}
.button-yes{background:linear-gradient(135deg,#ff4d88,#ff0066);color:white;box-shadow:0 8px 25px rgba(255,77,136,0.3)}
.button-no{background:#f0f0f0;color:#666;box-shadow:0 5px 15px rgba(0,0,0,0.1)}

/* Page drag & drop */
.drop-zone{background:#ffe6f2;border:3px dashed #ff4d88;border-radius:20px;padding:30px;margin:25px 0;transition:all 0.3s}
.drop-zone.active{background:#ffd1e3;border-color:#ff0066}
.drop-text{font-size:1.2rem;color:#ff4d88;font-weight:bold}

/* Coeur draggable */
.heart-container{position:relative;height:120px;margin:30px 0}
.draggable-heart{width:80px;height:80px;position:absolute;left:50%;top:0;transform:translateX(-50%);cursor:grab;touch-action:none;z-index:10}
.draggable-heart:active{cursor:grabbing}
.heart-origin{width:80px;height:80px;margin:0 auto;display:flex;align-items:center;justify-content:center;opacity:0.5}

/* Barre de progression */
.progress-container{width:100%;height:12px;background:#eee;border-radius:6px;margin:25px 0;overflow:hidden}
.progress-bar{height:100%;background:linear-gradient(to right,#ff4d88,#ff0066);width:0%;transition:width 0.3s}

/* Coeur qui se remplit */
.heart-fill-container{position:relative;width:100px;height:100px;margin:20px auto}
.fill-heart{width:100px;height:100px;background:#ff4d88;transform:rotate(-45deg);position:absolute}
.fill-heart:before,.fill-heart:after{content:'';width:100px;height:100px;background:#ff4d88;border-radius:50%;position:absolute}
.fill-heart:before{top:-50px;left:0}
.fill-heart:after{left:50px;top:0}
.fill-mask{position:absolute;bottom:0;width:100%;height:100%;background:white;transition:height 0.5s}
.heart-percent{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-weight:bold;font-size:1.2rem;z-index:2}

/* Message */
.message{background:#fff5f9;border-radius:15px;padding:15px;margin:20px 0;border-left:5px solid #ff4d88}

/* √âcran erreur */
.error-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:black;z-index:1000;display:none;align-items:center;justify-content:center;padding:20px}
.error-screen.active{display:flex}
.error-content{background:#111;color:#0f0;padding:25px;border-radius:15px;max-width:400px;width:100%;font-family:monospace}
.error-text{line-height:1.6}
.blink{animation:blink 1s infinite}
@keyframes blink{50%{opacity:0}}

/* Confetti */
.confetti{position:fixed;width:10px;height:10px;opacity:0;top:-10px}
@keyframes confetti-fall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(360deg);opacity:0}}

/* Volume control */
.volume-control{position:fixed;top:15px;right:15px;z-index:1000;background:rgba(255,255,255,0.9);border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center;box-shadow:0 3px 10px rgba(0,0,0,0.2)}
.volume-btn{font-size:28px;cursor:pointer;background:none;border:none;padding:0;width:100%;height:100%}

/* Responsive */
@media (max-width: 480px){
    .card{padding:20px}
    h1{font-size:1.5rem}
    .button{padding:16px;font-size:1.2rem}
    .envelope{font-size:70px}
    .volume-control{top:10px;right:10px;width:45px;height:45px}
}
</style>
</head>
<body>

<!-- Contr√¥le volume -->
<div class="volume-control">
    <button class="volume-btn" id="volumeBtn">üîä</button>
</div>

<!-- √âcran 1: Enveloppe -->
<div class="card" id="screen1">
    <h1>üíå Une lettre pour toi</h1>
    <p>Touche l'enveloppe pour ouvrir</p>
    <div class="envelope" id="envelope">üíå</div>
</div>

<!-- √âcran 2: Question -->
<div class="card hidden" id="screen2">
    <h1>Veux-tu √™tre ma Valentine ? üíò</h1>
    <p>Choisis avec ton c≈ìur...</p>
    
    <div class="buttons-container">
        <button class="button button-yes" id="btnYes">
            <span>OUI üíñ</span>
        </button>
        <button class="button button-no" id="btnNo">
            <span>NON üòî</span>
        </button>
    </div>
    
    <p style="font-size:0.9rem;color:#999">Ta r√©ponse va rendre mon jour sp√©cial</p>
</div>

<!-- √âcran 3: Drag & Drop -->
<div class="card hidden" id="screen3">
    <h1>Parfait! üíï</h1>
    <p>Maintenant, touche et glisse le c≈ìur pour confirmer</p>
    
    <div class="drop-zone" id="dropZone">
        <div class="drop-text" id="dropText">Glisse le c≈ìur ici</div>
    </div>
    
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <div class="heart-fill-container">
        <div class="fill-heart">
            <div class="fill-mask" id="fillMask"></div>
        </div>
        <div class="heart-percent" id="heartPercent">0%</div>
    </div>
    
    <div class="heart-container">
        <div class="heart-origin">‚Üì</div>
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ff4d88'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E" 
             class="draggable-heart" 
             id="draggableHeart"
             alt="C≈ìur"
             width="80"
             height="80">
    </div>
</div>

<!-- √âcran 4: Final -->
<div class="card hidden" id="screen4">
    <h1>üéâ MERCI! üíï</h1>
    
    <div class="message">
        <h2>Tu as dit OUI! ‚ù§Ô∏è</h2>
        <p>Tu as rendu ce jour incroyablement sp√©cial</p>
    </div>
    
    <div style="font-size:60px;margin:20px 0">
        üíñüíïüíò
    </div>
    
    <p style="font-size:1.3rem;color:#ff4d88;font-weight:bold">
        Je t'aime hyper fort!
    </p>
    
    <button class="button button-yes" id="btnFinal" style="margin-top:20px">
        <span>üéµ √âcouter notre musique</span>
    </button>
</div>

<!-- √âcran d'erreur -->
<div class="error-screen" id="errorScreen">
    <div class="error-content">
        <h2 style="color:#f00">‚ö† ERREUR SYST√àME</h2>
        <div class="error-text">
            <p>> D√©tection: Bouton "NON" d√©fectueux</p>
            <p>> Code: 0xLOVE_REQUIRED</p>
            <p>> Diagnostic: C≈ìur veut dire OUI</p>
            <p>> Correction automatique...</p>
            <p>> Redirection dans <span id="countdown">3</span>s <span class="blink">_</span></p>
        </div>
    </div>
</div>

<!-- √âl√©ments audio -->
<audio id="soundOpen" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
</audio>

<audio id="soundClick" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
</audio>

<audio id="soundYes" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
</audio>

<audio id="soundNo" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
</audio>

<audio id="soundHeart" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-heartbeat-998.mp3" type="audio/mpeg">
</audio>

<audio id="soundSuccess" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
</audio>

<audio id="soundMusic" preload="auto" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-loving-you-117.mp3" type="audio/mpeg">
</audio>

<audio id="soundError" preload="auto">
    <source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3" type="audio/mpeg">
</audio>

<script>
// ===== VARIABLES =====
let currentScreen = 1;
let progress = 0;
let isDragging = false;
let startX, startY;
let errorCount = 0;
let volumeOn = true;
let userInteracted = false;

// ===== INITIALISATION AUDIO =====
const sounds = {
    open: document.getElementById('soundOpen'),
    click: document.getElementById('soundClick'),
    yes: document.getElementById('soundYes'),
    no: document.getElementById('soundNo'),
    heart: document.getElementById('soundHeart'),
    success: document.getElementById('soundSuccess'),
    music: document.getElementById('soundMusic'),
    error: document.getElementById('soundError')
};

// Pr√©parer tous les sons
Object.values(sounds).forEach(sound => {
    sound.volume = 0.7;
    sound.muted = false;
});

// ===== FONCTIONS AUDIO =====
function playSound(soundName) {
    if (!volumeOn || !userInteracted) return;
    
    try {
        const sound = sounds[soundName];
        if (sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log("Audio error:", e));
        }
    } catch (e) {
        console.log("Sound error:", e);
    }
}

function stopSound(soundName) {
    const sound = sounds[soundName];
    if (sound) {
        sound.pause();
        sound.currentTime = 0;
    }
}

function stopAllSounds() {
    Object.values(sounds).forEach(sound => {
        sound.pause();
        sound.currentTime = 0;
    });
}

// Gestionnaire de volume
document.getElementById('volumeBtn').addEventListener('click', function() {
    volumeOn = !volumeOn;
    this.textContent = volumeOn ? 'üîä' : 'üîá';
    
    if (!volumeOn) {
        stopAllSounds();
    }
});

// ===== D√âTECTION PREMI√àRE INTERACTION =====
function initUserInteraction() {
    if (userInteracted) return;
    
    userInteracted = true;
    
    // D√©marrer un son pour activer l'audio sur mobile
    sounds.click.play().then(() => {
        sounds.click.pause();
        sounds.click.currentTime = 0;
    }).catch(() => {
        // Ignorer l'erreur, l'audio sera activ√© au prochain clic
    });
    
    // Supprimer les √©couteurs
    document.removeEventListener('click', initUserInteraction);
    document.removeEventListener('touchstart', initUserInteraction);
}

// √âcouter la premi√®re interaction
document.addEventListener('click', initUserInteraction);
document.addEventListener('touchstart', initUserInteraction);

// ===== FONCTIONS DE BASE =====
function showScreen(screenNumber) {
    // Cacher tous les √©crans
    document.getElementById('screen1').classList.add('hidden');
    document.getElementById('screen2').classList.add('hidden');
    document.getElementById('screen3').classList.add('hidden');
    document.getElementById('screen4').classList.add('hidden');
    
    // Arr√™ter la musique si on quitte l'√©cran final
    if (currentScreen === 4 && screenNumber !== 4) {
        stopSound('music');
    }
    
    // Montrer l'√©cran demand√©
    document.getElementById('screen' + screenNumber).classList.remove('hidden');
    currentScreen = screenNumber;
}

function createConfetti() {
    const colors = ['#ff4d88', '#ff0066', '#ff66b2', '#ff3385'];
    
    for (let i = 0; i < 30; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.animation = `confetti-fall ${Math.random() * 2 + 1}s linear forwards`;
        
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 3000);
    }
}

// ===== √âCRAN 1: ENVELOPPE =====
document.getElementById('envelope').addEventListener('click', function() {
    playSound('open');
    showScreen(2);
    this.style.transform = 'scale(1.2) rotate(10deg)';
    setTimeout(() => {
        this.style.transform = 'scale(1)';
    }, 300);
});

// Ajouter support tactile
document.getElementById('envelope').addEventListener('touchstart', function(e) {
    e.preventDefault();
    this.click();
});

// ===== √âCRAN 2: QUESTION =====
document.getElementById('btnYes').addEventListener('click', function() {
    playSound('yes');
    createConfetti();
    this.style.transform = 'scale(0.95)';
    
    setTimeout(() => {
        showScreen(3);
        initDragAndDrop();
    }, 500);
});

document.getElementById('btnNo').addEventListener('click', function() {
    playSound('no');
    errorCount++;
    
    // Diff√©rents effets selon le nombre de clics
    switch(errorCount) {
        case 1:
            playSound('error');
            showErrorScreen();
            break;
        case 2:
            playSound('heart');
            this.textContent = "S√ªr(e)? üíî";
            this.style.background = "#ffcccc";
            this.style.color = "#ff3333";
            break;
        case 3:
            playSound('click');
            this.textContent = "Euh... ü§î";
            this.style.transform = "translateX(20px)";
            setTimeout(() => {
                this.style.transform = "translateX(0)";
            }, 300);
            break;
        case 4:
            playSound('success');
            this.textContent = "Bon ok, OUI! üíñ";
            this.style.background = "linear-gradient(135deg,#ff4d88,#ff0066)";
            this.style.color = "white";
            
            // Auto-clic sur OUI apr√®s 1 seconde
            setTimeout(() => {
                document.getElementById('btnYes').click();
            }, 1000);
            break;
        default:
            playSound('click');
            // Faire bouger le bouton
            const x = Math.random() * 50 - 25;
            const y = Math.random() * 50 - 25;
            this.style.transform = `translate(${x}px, ${y}px)`;
            break;
    }
});

// Support tactile pour les boutons
['btnYes', 'btnNo'].forEach(id => {
    const btn = document.getElementById(id);
    btn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        this.click();
    });
});

function showErrorScreen() {
    document.getElementById('errorScreen').classList.add('active');
    playSound('error');
    
    let countdown = 3;
    const countdownEl = document.getElementById('countdown');
    countdownEl.textContent = countdown;
    
    const timer = setInterval(() => {
        countdown--;
        countdownEl.textContent = countdown;
        
        if (countdown <= 0) {
            clearInterval(timer);
            document.getElementById('errorScreen').classList.remove('active');
            document.getElementById('btnYes').click();
        }
    }, 1000);
}

// ===== √âCRAN 3: DRAG & DROP =====
function initDragAndDrop() {
    const heart = document.getElementById('draggableHeart');
    const dropZone = document.getElementById('dropZone');
    const progressBar = document.getElementById('progressBar');
    const fillMask = document.getElementById('fillMask');
    const heartPercent = document.getElementById('heartPercent');
    const dropText = document.getElementById('dropText');
    
    let fillInterval;
    
    // Position initiale du c≈ìur
    const heartContainer = document.querySelector('.heart-container');
    const containerRect = heartContainer.getBoundingClientRect();
    const initialLeft = containerRect.width / 2 - 40; // 40 = moiti√© de la largeur du c≈ìur
    
    heart.style.position = 'absolute';
    heart.style.left = initialLeft + 'px';
    heart.style.top = '0px';
    
    // Sons de battement de c≈ìur pendant le drag
    let heartbeatInterval;
    
    function startHeartbeat() {
        if (heartbeatInterval) return;
        heartbeatInterval = setInterval(() => {
            playSound('heart');
        }, 800);
    }
    
    function stopHeartbeat() {
        if (heartbeatInterval) {
            clearInterval(heartbeatInterval);
            heartbeatInterval = null;
        }
    }
    
    // Gestion tactile pour mobile
    heart.addEventListener('touchstart', function(e) {
        e.preventDefault();
        isDragging = true;
        this.style.cursor = 'grabbing';
        this.style.zIndex = '1000';
        
        const touch = e.touches[0];
        startX = touch.clientX - this.offsetLeft;
        startY = touch.clientY - this.offsetTop;
        
        playSound('click');
        startHeartbeat();
    });
    
    // Gestion souris pour desktop
    heart.addEventListener('mousedown', function(e) {
        e.preventDefault();
        isDragging = true;
        this.style.cursor = 'grabbing';
        this.style.zIndex = '1000';
        
        startX = e.clientX - this.offsetLeft;
        startY = e.clientY - this.offsetTop;
        
        playSound('click');
        startHeartbeat();
    });
    
    // Mouvement tactile
    document.addEventListener('touchmove', function(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        const heart = document.getElementById('draggableHeart');
        
        const newX = touch.clientX - startX;
        const newY = touch.clientY - startY;
        
        heart.style.left = newX + 'px';
        heart.style.top = newY + 'px';
        
        checkDropZone(heart, dropZone);
    });
    
    // Mouvement souris
    document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        
        const heart = document.getElementById('draggableHeart');
        const newX = e.clientX - startX;
        const newY = e.clientY - startY;
        
        heart.style.left = newX + 'px';
        heart.style.top = newY + 'px';
        
        checkDropZone(heart, dropZone);
    });
    
    // Fin du drag
    document.addEventListener('touchend', function() {
        if (!isDragging) return;
        endDrag();
    });
    
    document.addEventListener('mouseup', function() {
        if (!isDragging) return;
        endDrag();
    });
    
    function checkDropZone(heart, zone) {
        const heartRect = heart.getBoundingClientRect();
        const zoneRect = zone.getBoundingClientRect();
        
        // V√©rifier collision
        const collision = !(
            heartRect.right < zoneRect.left ||
            heartRect.left > zoneRect.right ||
            heartRect.bottom < zoneRect.top ||
            heartRect.top > zoneRect.bottom
        );
        
        if (collision) {
            zone.classList.add('active');
            dropText.textContent = "Ne l√¢che pas!";
            
            // Commencer √† remplir
            if (!fillInterval && progress < 100) {
                fillInterval = setInterval(() => {
                    progress += 2;
                    updateProgress();
                    
                    if (progress >= 100) {
                        clearInterval(fillInterval);
                        completeDrag();
                    }
                }, 50);
            }
        } else {
            zone.classList.remove('active');
            dropText.textContent = "Glisse le c≈ìur ici";
            
            if (fillInterval) {
                clearInterval(fillInterval);
                fillInterval = null;
            }
        }
    }
    
    function updateProgress() {
        progressBar.style.width = progress + '%';
        fillMask.style.height = (100 - progress) + '%';
        heartPercent.textContent = Math.min(progress, 100) + '%';
        
        // Changer couleur
        const intensity = progress / 100;
        const heartColor = `rgb(255, ${77 + intensity * 50}, ${136 + intensity * 50})`;
        document.querySelector('.fill-heart').style.background = heartColor;
        
        // Son de progression
        if (progress % 25 === 0 && progress > 0 && progress < 100) {
            playSound('click');
        }
    }
    
    function endDrag() {
        isDragging = false;
        const heart = document.getElementById('draggableHeart');
        heart.style.cursor = 'grab';
        heart.style.zIndex = '10';
        
        dropZone.classList.remove('active');
        stopHeartbeat();
        
        if (fillInterval) {
            clearInterval(fillInterval);
            fillInterval = null;
        }
        
        // Si pas compl√©t√©, retourner √† la position initiale
        if (progress < 100) {
            heart.style.transition = 'all 0.5s ease';
            heart.style.left = initialLeft + 'px';
            heart.style.top = '0px';
            
            // R√©duire la progression
            const revert = setInterval(() => {
                if (progress > 0) {
                    progress -= 2;
                    updateProgress();
                } else {
                    clearInterval(revert);
                    dropText.textContent = "Glisse le c≈ìur ici";
                }
            }, 30);
            
            setTimeout(() => {
                heart.style.transition = '';
            }, 500);
        }
    }
    
    function completeDrag() {
        playSound('success');
        stopHeartbeat();
        dropZone.classList.remove('active');
        dropText.textContent = "‚úÖ Validation compl√®te!";
        
        setTimeout(() => {
            showScreen(4);
            createConfetti();
            // D√©marrer la musique automatiquement √† la fin
            setTimeout(() => {
                playSound('music');
            }, 500);
        }, 1000);
    }
}

// ===== √âCRAN 4: FINAL =====
document.getElementById('btnFinal').addEventListener('click', function() {
    if (sounds.music.paused) {
        playSound('music');
        this.textContent = "‚è∏Ô∏è Pause musique";
        createConfetti();
    } else {
        stopSound('music');
        this.textContent = "üéµ Reprendre la musique";
    }
});

// Support tactile
document.getElementById('btnFinal').addEventListener('touchstart', function(e) {
    e.preventDefault();
    this.click();
});

// ===== INITIALISATION =====
// S'assurer qu'on commence sur l'√©cran 1
showScreen(1);

// Support tactile am√©lior√©
document.addEventListener('touchstart', function() {}, {passive: true});

// Pr√©venir le zoom sur mobile
document.addEventListener('gesturestart', function(e) {
    e.preventDefault();
});

// Message de bienvenue
setTimeout(() => {
    if (currentScreen === 1) {
        const envelope = document.getElementById('envelope');
        envelope.style.animation = 'pulse 2s infinite';
    }
}, 1000);

// Correction pour iOS - forcer le redimensionnement
window.addEventListener('orientationchange', function() {
    setTimeout(() => {
        document.body.style.height = window.innerHeight + 'px';
    }, 100);
});

// Assurer que tout fonctionne apr√®s chargement
window.addEventListener('load', function() {
    // Pr√©charger les sons discr√®tement
    sounds.click.play().then(() => {
        sounds.click.pause();
        sounds.click.currentTime = 0;
    }).catch(() => {});
    
    // Message d'aide audio
    setTimeout(() => {
        if (currentScreen === 1 && !userInteracted) {
            const envelope = document.getElementById('envelope');
            envelope.style.animation = 'pulse 1s infinite';
        }
    }, 2000);
});
</script>
</body>
</html>
