<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pour toi ‚ù§Ô∏è</title>
<style>
:root{--pink:#ff4d88;--red:#ff3333}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;-moz-tap-highlight-color:transparent}
body{margin:0;min-height:100vh;display:grid;place-items:center;background:linear-gradient(135deg,#ffe6f0,#ffb3d9);font-family:'Arial Rounded MT Bold','Arial',sans-serif;touch-action:none}
.hidden{display:none !important}
.card{width:95vw;max-width:500px;background:white;border-radius:20px;padding:20px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.15);margin:10px}
h1,h2{margin:0 0 15px;font-size:1.8rem;line-height:1.3}
p{margin:0 0 15px;font-size:1rem;line-height:1.5}
button{border:none;border-radius:50px;padding:18px 30px;font-size:1.2rem;font-weight:bold;cursor:pointer;min-height:60px;min-width:140px}
.envelope{font-size:80px;cursor:pointer;touch-action:manipulation}

/* Page question */
.question-title{color:#ff4d88;margin-bottom:30px}
.question-instructions{margin:20px 0;color:#666;font-size:1.2rem}
.buttons-container{display:flex;flex-direction:column;gap:15px;margin-top:30px}
@media (min-width: 480px){.buttons-container{flex-direction:row;justify-content:center}}
.heart-button{background:linear-gradient(to right, #ff4d88, #ff0066);color:white;font-size:1.3rem;padding:20px 35px;display:flex;align-items:center;justify-content:center;gap:10px;transition:all 0.3s;width:100%}
@media (min-width: 480px){.heart-button{width:auto}}
.heart-button:active{transform:scale(0.95)}
.no-button{background:#e0e0e0;color:#666;font-size:1.3rem;padding:20px 35px;display:flex;align-items:center;justify-content:center;transition:all 0.3s;width:100%;position:relative}
@media (min-width: 480px){.no-button{width:auto}}
.no-button:active{transform:scale(0.95)}

/* Page drag & drop */
.drag-instructions{margin:20px 0;color:#ff4d88;font-weight:bold;min-height:30px;font-size:1.1rem}
.drop-zone{background:#ffe6f2;border:3px dashed #ff4d88;border-radius:15px;padding:25px;margin:20px 0;min-height:120px;display:flex;align-items:center;justify-content:center;position:relative;transition:all 0.3s;touch-action:none}
.drop-zone.hovered{background:#ffd1e3;border-color:#ff0066}
.drop-zone.full{background:#ffcce0}
.drop-text{font-size:1.2rem;color:#ff4d88;font-weight:bold;text-align:center}
.drop-icon{font-size:40px;margin-bottom:10px;display:block}

/* Coeur draggable - Version mobile optimis√©e */
.draggable-heart-container{display:flex;justify-content:center;margin:25px 0;position:relative;height:100px}
.draggable-heart{width:80px;height:80px;cursor:grab;user-select:none;touch-action:none;transition:transform 0.2s;position:absolute;z-index:10}
.draggable-heart.dragging{cursor:grabbing;transform:scale(1.15);z-index:100}
.draggable-heart.returning{transition:all 0.5s ease-out}
.heart-origin{width:80px;height:80px;opacity:0.3;display:flex;align-items:center;justify-content:center}

/* Barre de progression */
.heart-progress{width:100%;height:12px;background:#eee;border-radius:6px;margin:25px 0;overflow:hidden}
.progress-bar{height:100%;background:linear-gradient(to right, #ff4d88, #ff0066);width:0%;transition:width 0.3s}

/* Coeur qui se remplit */
.heart-fill-container{position:relative;width:120px;height:120px;margin:25px auto}
.fill-heart{width:120px;height:120px;background:#ff4d88;transform:rotate(-45deg);position:absolute;left:0;top:0}
.fill-heart::before,.fill-heart::after{content:"";width:120px;height:120px;background:#ff4d88;border-radius:50%;position:absolute}
.fill-heart::before{top:-60px;left:0}
.fill-heart::after{left:60px;top:0}
.fill-mask{position:absolute;bottom:0;left:0;width:100%;height:100%;background:white;transition:height 1s ease-out}
.heart-label{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);z-index:10;font-weight:bold;color:white;font-size:1.3rem}

/* Page finale */
.final-message{background:#fff5f9;border-radius:12px;padding:20px;margin:25px 0;border-left:5px solid #ff4d88}
.heart-row{display:flex;justify-content:center;gap:15px;margin:25px 0}
.heart-emoji{font-size:40px;animation:bounce 1s infinite alternate}
@keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-15px)}}
.heart-emoji:nth-child(2){animation-delay:0.2s}
.heart-emoji:nth-child(3){animation-delay:0.4s}

/* Animations */
.success-animation{animation:pulse 0.5s 3}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
.shake{animation:shake 0.5s}
@keyframes shake{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-5px)}20%,40%,60%,80%{transform:translateX(5px)}}

/* √âcran d'erreur syst√®me mobile */
.system-error{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:1000;display:none;align-items:center;justify-content:center;font-family:'Courier New',monospace;padding:20px}
.system-error.active{display:flex}
.terminal{background:#111;color:#0f0;padding:25px;border-radius:10px;max-width:95%;width:100%;box-shadow:0 0 30px #0f0}
.terminal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.terminal-title{font-weight:bold;font-size:1.2rem}
.terminal-close{color:#f00;cursor:pointer;font-size:1.5rem;padding:10px}
.terminal-text{line-height:1.6;font-size:1rem}
.blink{animation:blink 1s infinite}
@keyframes blink{50%{opacity:0}}
.glitch{position:relative;animation:glitch 0.3s infinite}
@keyframes glitch{0%{transform:translateX(0)}20%{transform:translateX(-2px)}40%{transform:translateX(2px)}60%{transform:translateX(-1px)}80%{transform:translateX(1px)}100%{transform:translateX(0)}}

/* Message flottant mobile */
.floating-message{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#ff4d88;color:white;padding:15px 20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.2);z-index:1001;display:none;animation:slideIn 0.5s;max-width:90%;text-align:center}
@keyframes slideIn{from{transform:translate(-50%, -100%);opacity:0}to{transform:translate(-50%, 0);opacity:1}}

/* Tap animation for mobile */
.tap-animation{position:absolute;width:60px;height:60px;border-radius:50%;background:rgba(255,77,136,0.2);animation:pulse-tap 1.5s infinite;pointer-events:none}
@keyframes pulse-tap{0%{transform:scale(0.8);opacity:0.7}100%{transform:scale(1.5);opacity:0}}

/* Feedback tactile */
.touch-feedback{position:fixed;width:50px;height:50px;border-radius:50%;background:rgba(255,77,136,0.5);pointer-events:none;z-index:1002;transform:translate(-50%, -50%);animation:ripple 0.6s ease-out}
@keyframes ripple{0%{transform:translate(-50%, -50%) scale(0);opacity:1}100%{transform:translate(-50%, -50%) scale(3);opacity:0}}

/* Instructions mobiles */
.mobile-hint{position:absolute;bottom:-40px;left:0;width:100%;text-align:center;color:#ff4d88;font-size:0.9rem;font-weight:bold}
.mobile-hint::before{content:"üëÜ ";font-size:1.2rem}

/* Loader pour mobile */
.loader{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #ff4d88;border-radius:50%;animation:spin 1s linear infinite;margin:20px auto}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* Safe area pour iPhone */
@supports(padding:max(0px)){
    .card, .floating-message{padding-left:max(20px, env(safe-area-inset-left));padding-right:max(20px, env(safe-area-inset-right))}
    body{padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom)}
}
</style>
</head>
<body>

<!-- ENVELOPPE -->
<div class="card" id="pageEnvelope">
  <div class="envelope" id="openEnvelope">üíå</div>
  <p>Appuie sur l'enveloppe</p>
  <div class="tap-animation"></div>
</div>

<!-- PAGE QUESTION -->
<div class="card hidden" id="pageQuestion">
  <h1 class="question-title">Veux-tu √™tre ma Valentine ? üíò</h1>
  
  <div class="question-instructions">
    Choisis ta r√©ponse :
  </div>
  
  <div class="buttons-container">
    <button class="heart-button" id="yesButton">
      <span>OUI üíñ</span>
    </button>
    <button class="no-button" id="noButton">
      <span>NON üòî</span>
    </button>
  </div>
  
  <p style="margin-top:30px; color:#666; font-size:1rem">
    Ta r√©ponse va rendre mon jour sp√©cial...
  </p>
</div>

<!-- PAGE DRAG & DROP -->
<div class="card hidden" id="pageDrag">
  <h1 style="color:#ff4d88">Super! Maintenant confirme avec ton c≈ìur üíï</h1>
  
  <div class="drag-instructions" id="instructions">
    Touche et glisse le c≈ìur vers la zone ci-dessous
  </div>
  
  <div class="heart-progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  
  <div class="heart-fill-container">
    <div class="fill-heart">
      <div class="fill-mask" id="fillMask"></div>
    </div>
    <div class="heart-label" id="heartLabel">0%</div>
  </div>
  
  <div class="drop-zone" id="dropZone">
    <div class="drop-icon">üíù</div>
    <div class="drop-text" id="dropText">D√©pose ici pour valider</div>
  </div>
  
  <div class="draggable-heart-container">
    <div class="heart-origin">
      <div class="loader" id="heartLoader"></div>
    </div>
    <img src="https://cdn-icons-png.flaticon.com/512/210/210545.png" class="draggable-heart" id="draggableHeart" alt="Coeur √† glisser">
  </div>
  
  <p style="margin-top:20px; color:#666; font-size:1rem">
    <span class="mobile-hint">Touche longtemps le c≈ìur et glisse-le</span>
  </p>
</div>

<!-- PAGE FINALE -->
<div class="card hidden" id="pageFinal">
  <div style="width:100%;height:200px;background:linear-gradient(135deg,#ff4d88,#ff0066);border-radius:15px;display:flex;align-items:center;justify-content:center;margin-bottom:20px">
    <div style="font-size:80px">üíñ</div>
  </div>
  
  <div class="final-message">
    <h2>Double validation r√©ussie! üíï</h2>
    <p>Tu as dit OUI et confirm√© avec ton c≈ìur!</p>
  </div>
  
  <div class="heart-row">
    <div class="heart-emoji">üíñ</div>
    <div class="heart-emoji">üíï</div>
    <div class="heart-emoji">üíò</div>
  </div>
  
  <p style="font-size:1.3rem;color:#ff4d88;font-weight:bold">Je t'aime hyper fort ‚ù§Ô∏è</p>
  
  <button class="heart-button" id="thanks" style="margin-top:20px">
    <span>Merci pour ce OUI üíñ</span>
  </button>
</div>

<!-- √âCRAN D'ERREUR SYST√àME -->
<div class="system-error" id="systemError">
  <div class="terminal">
    <div class="terminal-header">
      <div class="terminal-title">ERREUR SYST√àME</div>
      <div class="terminal-close" id="closeError">‚úï</div>
    </div>
    <div class="terminal-text">
      <p>> ERREUR: BOUTON "NON" D√âFECTUEUX</p>
      <p>> Code: 0xHEART_MALFUNCTION</p>
      <p>> Analyse en cours<span class="blink">...</span></p>
      <p class="glitch">> Syst√®me d√©tecte: ‚ù§Ô∏è veut dire OUI</p>
      <p>> R√©paration automatique...</p>
      <p>> Redirection vers OUI dans <span id="countdown">5</span>s<span class="blink">_</span></p>
    </div>
  </div>
</div>

<!-- MESSAGE FLOTTANT -->
<div class="floating-message" id="floatingMessage">
  Le syst√®me d√©tecte que ton c≈ìur veut dire OUI! üíñ
</div>

<!-- Sons -->
<audio id="music" src="LoversRock.mp3" loop preload="auto"></audio>
<audio id="errorSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
</audio>
<audio id="clickSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
</audio>
<audio id="successSound" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
</audio>

<script>
// ========== √âL√âMENTS DOM ==========
const pageEnvelope = document.getElementById('pageEnvelope');
const pageQuestion = document.getElementById('pageQuestion');
const pageDrag = document.getElementById('pageDrag');
const pageFinal = document.getElementById('pageFinal');
const yesButton = document.getElementById('yesButton');
const noButton = document.getElementById('noButton');
const instructions = document.getElementById('instructions');
const dropZone = document.getElementById('dropZone');
const dropText = document.getElementById('dropText');
const draggableHeart = document.getElementById('draggableHeart');
const heartLoader = document.getElementById('heartLoader');
const progressBar = document.getElementById('progressBar');
const fillMask = document.getElementById('fillMask');
const heartLabel = document.getElementById('heartLabel');
const music = document.getElementById('music');
const thanks = document.getElementById('thanks');
const systemError = document.getElementById('systemError');
const closeError = document.getElementById('closeError');
const countdownElement = document.getElementById('countdown');
const floatingMessage = document.getElementById('floatingMessage');

// ========== VARIABLES ==========
let isDragging = false;
let progress = 0;
let fillInterval = null;
let noButtonClickCount = 0;
let noButtonMoving = false;
let startX, startY, initialX, initialY;
let heartOrigin = null;

// ========== INITIALISATION ==========
document.addEventListener('DOMContentLoaded', () => {
  // Pr√©charger les sons
  preloadAudio();
  
  // Initialiser la position d'origine du c≈ìur
  setTimeout(() => {
    const rect = draggableHeart.getBoundingClientRect();
    heartOrigin = {
      x: rect.left,
      y: rect.top,
      width: rect.width,
      height: rect.height
    };
    heartLoader.classList.add('hidden');
  }, 500);
  
  // Adapter pour mobile
  if (isMobile()) {
    document.body.style.touchAction = 'none';
    makeButtonsLargerForMobile();
  }
});

// ========== FONCTIONS MOBILE ==========
function isMobile() {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

function makeButtonsLargerForMobile() {
  const buttons = document.querySelectorAll('button');
  buttons.forEach(btn => {
    btn.style.padding = '22px 35px';
    btn.style.fontSize = '1.4rem';
    btn.style.minHeight = '70px';
  });
}

function showTouchFeedback(x, y) {
  const feedback = document.createElement('div');
  feedback.className = 'touch-feedback';
  feedback.style.left = x + 'px';
  feedback.style.top = y + 'px';
  document.body.appendChild(feedback);
  
  setTimeout(() => {
    feedback.remove();
  }, 600);
}

// ========== √âTAPE 1: OUVERTURE ENVELOPPE ==========
openEnvelope.addEventListener('click', openEnvelopeHandler);
openEnvelope.addEventListener('touchstart', (e) => {
  e.preventDefault();
  showTouchFeedback(e.touches[0].clientX, e.touches[0].clientY);
  openEnvelopeHandler();
});

function openEnvelopeHandler() {
  playClickSound();
  pageEnvelope.classList.add('hidden');
  pageQuestion.classList.remove('hidden');
  
  // Animation
  pageQuestion.style.transform = 'scale(0.9)';
  pageQuestion.style.opacity = '0';
  
  setTimeout(() => {
    pageQuestion.style.transition = 'all 0.3s ease';
    pageQuestion.style.transform = 'scale(1)';
    pageQuestion.style.opacity = '1';
  }, 10);
  
  setTimeout(() => {
    showFloatingMessage("Choisis avec ton c≈ìur üíñ");
  }, 1000);
}

// ========== √âTAPE 2: BOUTON OUI ==========
yesButton.addEventListener('click', yesButtonHandler);
yesButton.addEventListener('touchstart', (e) => {
  e.preventDefault();
  showTouchFeedback(e.touches[0].clientX, e.touches[0].clientY);
  yesButtonHandler();
});

function yesButtonHandler() {
  playSuccessSound();
  yesButton.classList.add('success-animation');
  
  // Transition vers page drag & drop
  setTimeout(() => {
    pageQuestion.classList.add('hidden');
    pageDrag.classList.remove('hidden');
    
    // Animation d'entr√©e
    pageDrag.style.transform = 'translateY(20px)';
    pageDrag.style.opacity = '0';
    
    setTimeout(() => {
      pageDrag.style.transition = 'all 0.4s ease';
      pageDrag.style.transform = 'translateY(0)';
      pageDrag.style.opacity = '1';
    }, 10);
    
    // Instructions pour mobile
    if (isMobile()) {
      instructions.textContent = "Touche longtemps le c≈ìur et glisse-le vers la zone rose";
      showFloatingMessage("Glisse le c≈ìur pour confirmer ton OUI üíï");
    }
  }, 500);
}

// ========== √âTAPE 3: BOUTON NON (PROBL√àMES) ==========
noButton.addEventListener('click', noButtonHandler);
noButton.addEventListener('touchstart', (e) => {
  e.preventDefault();
  if (noButtonMoving) return;
  
  showTouchFeedback(e.touches[0].clientX, e.touches[0].clientY);
  noButtonHandler();
});

function noButtonHandler() {
  noButtonClickCount++;
  playErrorSound();
  noButton.classList.add('shake');
  
  setTimeout(() => {
    noButton.classList.remove('shake');
  }, 500);
  
  // Comportements diff√©rents selon le nombre de clics
  switch(noButtonClickCount) {
    case 1:
      showSystemError();
      showFloatingMessage("Erreur d√©tect√©e! Essaie OUI üíñ");
      break;
      
    case 2:
      noButton.innerHTML = "S√ªr(e)? üíî";
      makeButtonMove();
      showFloatingMessage("Ton c≈ìur murmure OUI...");
      break;
      
    case 3:
      noButton.innerHTML = "Vraiment? üò¢";
      noButton.style.transform = "scale(0.9)";
      showFloatingMessage("Le OUI est tellement plus beau!");
      break;
      
    case 4:
      noButton.innerHTML = "Attends... ü§î";
      noButton.style.background = "#ffcccc";
      noButton.style.color = "#ff3333";
      showFloatingMessage("Presque convaincu(e) de dire OUI?");
      break;
      
    case 5:
      // Transformation finale en OUI
      noButton.innerHTML = "Bon ok... OUI! üíñ";
      noButton.style.background = "linear-gradient(to right, #ff4d88, #ff0066)";
      noButton.style.color = "white";
      noButton.style.transform = "scale(1.1)";
      noButton.style.boxShadow = "0 5px 20px rgba(255,77,136,0.4)";
      showFloatingMessage("YES! Je savais que tu dirais OUI! üéâ");
      
      // Auto-clic sur OUI apr√®s d√©lai
      setTimeout(() => {
        yesButtonHandler();
      }, 1500);
      break;
      
    default:
      // Continue √† bouger
      makeButtonMove();
      break;
  }
}

// ========== DRAG & DROP POUR MOBILE ==========
// √âv√©nements tactiles pour le c≈ìur
draggableHeart.addEventListener('touchstart', handleTouchStart, { passive: false });
document.addEventListener('touchmove', handleTouchMove, { passive: false });
document.addEventListener('touchend', handleTouchEnd, { passive: false });

// √âv√©nements souris pour desktop
draggableHeart.addEventListener('mousedown', handleMouseDown);
document.addEventListener('mousemove', handleMouseMove);
document.addEventListener('mouseup', handleMouseEnd);

function handleTouchStart(e) {
  e.preventDefault();
  if (isDragging) return;
  
  const touch = e.touches[0];
  startX = touch.clientX;
  startY = touch.clientY;
  
  // Position initiale
  const rect = draggableHeart.getBoundingClientRect();
  initialX = rect.left;
  initialY = rect.top;
  
  isDragging = true;
  draggableHeart.classList.add('dragging');
  draggableHeart.style.position = 'fixed';
  draggableHeart.style.zIndex = '1000';
  
  instructions.textContent = "Ne l√¢che pas! Continue...";
  showTouchFeedback(startX, startY);
}

function handleTouchMove(e) {
  if (!isDragging) return;
  e.preventDefault();
  
  const touch = e.touches[0];
  const currentX = touch.clientX;
  const currentY = touch.clientY;
  
  // D√©placer le c≈ìur
  draggableHeart.style.left = (currentX - draggableHeart.offsetWidth / 2) + 'px';
  draggableHeart.style.top = (currentY - draggableHeart.offsetHeight / 2) + 'px';
  
  // V√©rifier si on est sur la drop zone
  const dropZoneRect = dropZone.getBoundingClientRect();
  const heartRect = draggableHeart.getBoundingClientRect();
  
  const isOverDropZone = 
    heartRect.left < dropZoneRect.right &&
    heartRect.right > dropZoneRect.left &&
    heartRect.top < dropZoneRect.bottom &&
    heartRect.bottom > dropZoneRect.top;
  
  if (isOverDropZone) {
    dropZone.classList.add('hovered');
    
    // Commencer √† remplir si pas d√©j√†
    if (!fillInterval) {
      fillInterval = setInterval(() => {
        if (progress < 100) {
          progress += 3; // Plus rapide sur mobile
          updateProgress();
          
          // Messages de progression
          if (progress < 25) {
            dropText.textContent = "Validation...";
          } else if (progress < 50) {
            dropText.textContent = "Continue...";
          } else if (progress < 75) {
            dropText.textContent = "Presque!";
          } else if (progress < 90) {
            dropText.textContent = "OUI confirm√©!";
          } else {
            dropText.textContent = "üíñ COMPLET üíñ";
          }
        } else {
          clearInterval(fillInterval);
          completeDrag();
        }
      }, 50);
    }
  } else {
    dropZone.classList.remove('hovered');
    if (fillInterval) {
      clearInterval(fillInterval);
      fillInterval = null;
    }
  }
}

function handleTouchEnd(e) {
  if (!isDragging) return;
  e.preventDefault();
  
  isDragging = false;
  draggableHeart.classList.remove('dragging');
  dropZone.classList.remove('hovered');
  
  if (fillInterval) {
    clearInterval(fillInterval);
    fillInterval = null;
  }
  
  // Si pas compl√©t√©, retour √† la position initiale
  if (progress < 100) {
    draggableHeart.classList.add('returning');
    draggableHeart.style.transition = 'all 0.5s ease-out';
    draggableHeart.style.left = initialX + 'px';
    draggableHeart.style.top = initialY + 'px';
    draggableHeart.style.position = 'absolute';
    
    // R√©duire la progression
    const revertInterval = setInterval(() => {
      if (progress > 0) {
        progress -= 5;
        updateProgress();
      } else {
        clearInterval(revertInterval);
        instructions.textContent = "Presque! Glisse jusqu'au bout";
        dropText.textContent = "D√©pose ici pour valider";
      }
    }, 30);
    
    setTimeout(() => {
      draggableHeart.classList.remove('returning');
      draggableHeart.style.transition = '';
    }, 500);
  }
}

// Gestion souris (desktop)
function handleMouseDown(e) {
  e.preventDefault();
  startX = e.clientX;
  startY = e.clientY;
  
  const rect = draggableHeart.getBoundingClientRect();
  initialX = rect.left;
  initialY = rect.top;
  
  isDragging = true;
  draggableHeart.classList.add('dragging');
  draggableHeart.style.position = 'fixed';
  draggableHeart.style.zIndex = '1000';
}

function handleMouseMove(e) {
  if (!isDragging) return;
  
  const currentX = e.clientX;
  const currentY = e.clientY;
  
  draggableHeart.style.left = (currentX - draggableHeart.offsetWidth / 2) + 'px';
  draggableHeart.style.top = (currentY - draggableHeart.offsetHeight / 2) + 'px';
  
  // V√©rification drop zone
  const dropZoneRect = dropZone.getBoundingClientRect();
  const heartRect = draggableHeart.getBoundingClientRect();
  
  const isOverDropZone = 
    heartRect.left < dropZoneRect.right &&
    heartRect.right > dropZoneRect.left &&
    heartRect.top < dropZoneRect.bottom &&
    heartRect.bottom > dropZoneRect.top;
  
  if (isOverDropZone) {
    dropZone.classList.add('hovered');
    
    if (!fillInterval) {
      fillInterval = setInterval(() => {
        if (progress < 100) {
          progress += 2;
          updateProgress();
          
          if (progress < 30) dropText.textContent = "Validation...";
          else if (progress < 60) dropText.textContent = "Continue...";
          else if (progress < 90) dropText.textContent = "Presque!";
          else dropText.textContent = "üíñ COMPLET üíñ";
        } else {
          clearInterval(fillInterval);
          completeDrag();
        }
      }, 50);
    }
  } else {
    dropZone.classList.remove('hovered');
    if (fillInterval) {
      clearInterval(fillInterval);
      fillInterval = null;
    }
  }
}

function handleMouseEnd(e) {
  if (!isDragging) return;
  
  isDragging = false;
  draggableHeart.classList.remove('dragging');
  dropZone.classList.remove('hovered');
  
  if (fillInterval) {
    clearInterval(fillInterval);
    fillInterval = null;
  }
  
  if (progress < 100) {
    draggableHeart.classList.add('returning');
    draggableHeart.style.transition = 'all 0.5s ease-out';
    draggableHeart.style.left = initialX + 'px';
    draggableHeart.style.top = initialY + 'px';
    draggableHeart.style.position = 'absolute';
    
    const revertInterval = setInterval(() => {
      if (progress > 0) {
        progress -= 3;
        updateProgress();
      } else {
        clearInterval(revertInterval);
        instructions.textContent = "Glisse le c≈ìur vers la zone";
        dropText.textContent = "D√©pose ici pour valider";
      }
    }, 30);
    
    setTimeout(() => {
      draggableHeart.classList.remove('returning');
      draggableHeart.style.transition = '';
    }, 500);
  }
}

// ========== MISE √Ä JOUR PROGRESSION ==========
function updateProgress() {
  progressBar.style.width = `${progress}%`;
  fillMask.style.height = `${100 - progress}%`;
  heartLabel.textContent = `${Math.round(progress)}%`;
  
  // Changement de couleur
  const r = 255;
  const g = Math.floor(77 + progress * 0.8);
  const b = Math.floor(136 + progress * 0.5);
  const heartColor = `rgb(${r}, ${g}, ${b})`;
  
  const heart = document.querySelector('.fill-heart');
  heart.style.background = heartColor;
  heart.style.setProperty('--heart-color', heartColor);
}

// ========== VALIDATION COMPL√àTE ==========
function completeDrag() {
  draggableHeart.style.display = 'none';
  dropZone.classList.add('full');
  dropZone.classList.add('success-animation');
  instructions.textContent = "Validation compl√®te! üíï";
  
  // Sons et animations
  playSuccessSound();
  
  // Transition vers page finale
  setTimeout(() => {
    pageDrag.classList.add('hidden');
    pageFinal.classList.remove('hidden');
    
    // Animation
    pageFinal.style.transform = 'scale(0.9)';
    pageFinal.style.opacity = '0';
    
    setTimeout(() => {
      pageFinal.style.transition = 'all 0.5s ease';
      pageFinal.style.transform = 'scale(1)';
      pageFinal.style.opacity = '1';
    }, 10);
    
    // Musique
    music.play().catch(e => {
      console.log("Musique n√©cessite interaction:", e);
      // On attend un clic sur le bouton merci
    });
  }, 1000);
}

// ========== FONCTIONS UTILITAIRES ==========
function showSystemError() {
  systemError.classList.add('active');
  
  let countdown = 5;
  countdownElement.textContent = countdown;
  
  const countdownInterval = setInterval(() => {
    countdown--;
    countdownElement.textContent = countdown;
    
    if (countdown <= 0) {
      clearInterval(countdownInterval);
      systemError.classList.remove('active');
      showFloatingMessage("Redirection vers OUI...");
      setTimeout(() => yesButtonHandler(), 500);
    }
  }, 1000);
}

function makeButtonMove() {
  if (noButtonMoving || !isMobile()) return;
  
  noButtonMoving = true;
  const button = noButton;
  const container = button.parentElement;
  const containerRect = container.getBoundingClientRect();
  
  let moves = 0;
  const moveInterval = setInterval(() => {
    if (moves >= 6) {
      clearInterval(moveInterval);
      noButtonMoving = false;
      return;
    }
    
    const maxX = containerRect.width - button.offsetWidth - 10;
    const maxY = containerRect.height - button.offsetHeight - 10;
    
    const randomX = Math.random() * maxX;
    const randomY = Math.random() * maxY;
    
    button.style.position = 'absolute';
    button.style.left = `${randomX}px`;
    button.style.top = `${randomY}px`;
    
    moves++;
  }, 400);
}

function showFloatingMessage(text) {
  floatingMessage.textContent = text;
  floatingMessage.style.display = 'block';
  
  setTimeout(() => {
    floatingMessage.style.display = 'none';
  }, 3000);
}

// ========== GESTION DES SONS ==========
function preloadAudio() {
  // Les sons sont pr√©charg√©s via preload="auto"
}

function playErrorSound() {
  try {
    errorSound.currentTime = 0;
    errorSound.play();
  } catch (e) {
    console.log("Son d'erreur ignor√©:", e);
  }
}

function playClickSound() {
  try {
    clickSound.currentTime = 0;
    clickSound.play